## 3I04 市川 敬士

# A/D変換

## 1. 抵抗ラダー型D/A

### 内容

- AVRに4ビットD/A変換回路を接続し、VoにPB(PB3 PB2 PB1 PB0)にほぼ比例した電圧が出力されることを確かめよ。  
またVoを計測しなさい。

- コード

```c
#include <asf.h>
#define F_CPU 20000000UL
#include <util/delay.h>
int main() //IO ポート設定
{
	DDRB = 0b00001111;
	int c = 0;
	while(true){
		c++;
		PORTB = c;
		_delay_us(20000000);
	}
	return 0;
}
```

- 表

- グラフ

## 2. コンバレータ

### 穴埋め

1. データシート

2. 前知識

3. 概要

- 比較器を使用するには、ACDをOFFにする。
- 入力端子は+端子の"AIN0"と-端子の"AIN1"であり、この電圧を比較する。
- 比較するには、ACBGを論理値"false"、ACMEを論理値"true"、ADENを論理値"false"にすればよい。
- この図の他、以下のページ、項目を参照する。
  - "243"ページ"表23-1"
  - "12"ページ"図1-1"
  - "97"ページ"表14-9"

4. ピン配置 

- ピン配置は図"1-1"、表"14-9"を参照すればいい。
- AIN0はポート"D"の"6"bit目、ICの"8"番ピンである。
- AIN0はポート"D"の"7"bit目、ICの"9"番ピンである。

5. 省電力設定

- ADCについては、"244"ページに書かれている。
- ADCを使用するには、PRADCを論理値"0"にする。
- PRADCは"Power Reduction"レジスタの"0"ビット目である。
- PRADCが論理値"1"の時とき、コンパレータはADC input MUXを使用できない。
- ディジタル入力にはディセーブル機能があり、"Digital Input Disable"レジスタ("245"ページ)、"Digital Input Disable"レジスタ("260"ページ)で設定する
- AIN1、AIN0を使用する場合、AIN1D、AIN0Dを論理値"1"にセットし、ディジタル入力バッファをディセーブルにすることができる。

6. その他のパラメータ

- ACMEはADCSRBレジスタの6ビット目である。  
論理値0のとき、-入力端子AIN1がコンパレータに接続される。
- ADENはADCSRAレジスタの7ビット目である。  
論理値0のとき、ADCがOFFになる。
- ACOはACSRレジスタの5ビット目である。コンパレータ出力端子。
- ACDはACSRレジスタの7ビット目である。  
論理値1のとき、コンパレータがOFFになる。
- ACBGはACSRレジスタの6ビット目である。  
論理値0のとき、+入力端子AIN0がコンパレータに接続される。
- ACDは論理値1で比較器の電源がOFFになる。
- ACOには1~2クロック分のディレイが発生する。

7. まとめ

PRR 0x64 0 なし  
ACSR 0x30 7,6 なし
ADCSRB 0x7B なし 6
ADCSRA 0x7A 7 なし
DIDR0 0x7E なし なし
DIDR1 0x7F なし 1,0

8. 遅延時間

比較器の遅延時間(Propagation Delay)を調べる。表30-1のDC特性を参照する。  
表から2.7Vで750ns(標準)、4Vで500ns(標準)である。遅延時間は一般に電圧が高いほど短くなるから、5Vでは500ns(最大)と予想する。これは、20MHz動作で10クロックに相当する。  
さらにACOがセットされるまでに1~2クロック必要だから、比較器への入力が安定後、合計11~12クロック(0.6μs)必要であることがわかる。

9. プログラミング基礎知識(補足)

- 例えば、PINB:0x03番地、PORTB:0x05番地、DDRB:0x04番地、PRR:0x64番地
- IN、OUT命令は、0x00~0x3F番地のアドレスに対して使用
- LDS、STS命令は0x60-0xFF番地のアドレスに対して使用
- SBI、CBI命令は0x00~0x1F番地のアドレスに対して使用